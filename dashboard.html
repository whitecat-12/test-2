<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Guru - Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-xl font-bold text-center mb-4">Dashboard Guru - Upload Soal</h1>

    <!-- Form input soal -->
    <form id="soalForm" class="space-y-4">
      <input type="hidden" id="soalId"> <!-- Untuk edit soal -->
      <div>
        <label class="block font-semibold">Pertanyaan:</label>
        <textarea id="pertanyaan" class="w-full border p-2 rounded" required></textarea>
      </div>
      <div>
        <label class="block font-semibold">Opsi Jawaban:</label>
        <input type="text" id="opsiA" placeholder="A" class="w-full border p-2 rounded mb-2" required>
        <input type="text" id="opsiB" placeholder="B" class="w-full border p-2 rounded mb-2" required>
        <input type="text" id="opsiC" placeholder="C" class="w-full border p-2 rounded mb-2" required>
        <input type="text" id="opsiD" placeholder="D" class="w-full border p-2 rounded mb-2" required>
      </div>
      <div>
        <label class="block font-semibold">Jawaban Benar:</label>
        <select id="jawaban" class="w-full border p-2 rounded">
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <option value="D">D</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold">Penjelasan:</label>
        <textarea id="penjelasan" class="w-full border p-2 rounded"></textarea>
      </div>
      <button type="submit" class="w-full bg-teal-600 text-white p-3 rounded-lg">Simpan Soal</button>
    </form>

    <!-- List soal -->
    <div class="mt-6">
      <h2 class="font-bold text-lg mb-2">Daftar Soal</h2>
      <ul id="daftarSoal" class="list-disc pl-6 space-y-2"></ul>
    </div>

    <button id="logoutBtn" class="mt-6 w-full bg-red-500 text-white p-2 rounded">Logout</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAJ5I8k2MzAyDLt9fUcXHRNtRVjKB_ETLY",
      authDomain: "projectid-81104.firebaseapp.com",
      projectId: "projectid-81104",
      storageBucket: "projectid-81104.firebasestorage.app",
      messagingSenderId: "554913260457",
      appId: "1:554913260457:web:bf988867ebfd902c651ab8",
      measurementId: "G-8WFHQW5WGN"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const soalForm = document.getElementById('soalForm');
    const daftarSoal = document.getElementById('daftarSoal');
    const logoutBtn = document.getElementById('logoutBtn');

    // Cek login
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        alert("Harus login dulu!");
        window.location.href = "login.html";
      }
    });

    // Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });

    // Simpan / Edit soal
    soalForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const soalId = document.getElementById("soalId").value;
      const soalData = {
        pertanyaan: document.getElementById("pertanyaan").value,
        opsi: {
          A: document.getElementById("opsiA").value,
          B: document.getElementById("opsiB").value,
          C: document.getElementById("opsiC").value,
          D: document.getElementById("opsiD").value
        },
        jawaban: document.getElementById("jawaban").value,
        penjelasan: document.getElementById("penjelasan").value
      };

      if (soalId) {
        // Edit soal
        await updateDoc(doc(db, "soal", soalId), soalData);
      } else {
        // Tambah soal baru
        await addDoc(collection(db, "soal"), soalData);
      }

      soalForm.reset();
      document.getElementById("soalId").value = "";
      loadSoal();
    });

    // Ambil soal dari Firestore
    async function loadSoal() {
      daftarSoal.innerHTML = "";
      const snapshot = await getDocs(collection(db, "soal"));
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const li = document.createElement("li");
        li.classList.add("flex", "justify-between", "items-center");
        li.innerHTML = `
          <span>${data.pertanyaan} (Jawaban: ${data.jawaban})</span>
          <span class="space-x-2">
            <button data-id="${docSnap.id}" class="editBtn bg-blue-500 text-white px-2 py-1 rounded">Edit</button>
            <button data-id="${docSnap.id}" class="deleteBtn bg-red-500 text-white px-2 py-1 rounded">Hapus</button>
          </span>
        `;
        daftarSoal.appendChild(li);
      });

      // Event edit
      document.querySelectorAll(".editBtn").forEach(btn => {
        btn.addEventListener("click", async () => {
          const docId = btn.dataset.id;
          const docRef = doc(db, "soal", docId);
          const docSnap = await getDocs(collection(db, "soal"));
          const docData = (await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js")).doc(db, "soal", docId)
          // ambil data soal untuk form
          const snapshot = await getDocs(collection(db, "soal"));
          const data = (await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js")).getDoc(docRef);
          data.then(d => {
            if(d.exists()){
              document.getElementById("soalId").value = docId;
              document.getElementById("pertanyaan").value = d.data().pertanyaan;
              document.getElementById("opsiA").value = d.data().opsi.A;
              document.getElementById("opsiB").value = d.data().opsi.B;
              document.getElementById("opsiC").value = d.data().opsi.C;
              document.getElementById("opsiD").value = d.data().opsi.D;
              document.getElementById("jawaban").value = d.data().jawaban;
              document.getElementById("penjelasan").value = d.data().penjelasan;
            }
          });
        });
      });

      // Event hapus
      document.querySelectorAll(".deleteBtn").forEach(btn => {
        btn.addEventListener("click", async () => {
          if(confirm("Yakin ingin menghapus soal ini?")){
            await deleteDoc(doc(db, "soal", btn.dataset.id));
            loadSoal();
          }
        });
      });
    }

    loadSoal();
  </script>
</body>
</html>
