<!DOCTYPE html> 
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Guru - Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
  <div class="max-w-2xl mx-auto bg-white shadow-lg rounded-xl p-6">
    <h1 class="text-xl font-bold text-center mb-4">Dashboard Guru - Upload Soal</h1>

    <!-- Form input soal -->
    <form id="soalForm" class="space-y-4">
      <div>
        <label class="block font-semibold">Pertanyaan:</label>
        <textarea id="pertanyaan" class="w-full border p-2 rounded" required></textarea>
      </div>
      <div>
        <label class="block font-semibold">Opsi Jawaban:</label>
        <input type="text" id="opsiA" placeholder="A" class="w-full border p-2 rounded mb-2" required>
        <input type="text" id="opsiB" placeholder="B" class="w-full border p-2 rounded mb-2" required>
        <input type="text" id="opsiC" placeholder="C" class="w-full border p-2 rounded mb-2" required>
        <input type="text" id="opsiD" placeholder="D" class="w-full border p-2 rounded mb-2" required>
      </div>
      <div>
        <label class="block font-semibold">Jawaban Benar:</label>
        <select id="jawaban" class="w-full border p-2 rounded">
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <option value="D">D</option>
        </select>
      </div>
      <div>
        <label class="block font-semibold">Penjelasan:</label>
        <textarea id="penjelasan" class="w-full border p-2 rounded"></textarea>
      </div>
      <button type="submit" class="w-full bg-teal-600 text-white p-3 rounded-lg">Simpan Soal</button>
    </form>

    <!-- List soal -->
    <div class="mt-6">
      <h2 class="font-bold text-lg mb-2">Daftar Soal</h2>
      <ul id="daftarSoal" class="list-disc pl-6 space-y-2"></ul>
    </div>

    <button id="logoutBtn" class="mt-6 w-full bg-red-500 text-white p-2 rounded">Logout</button>
  </div>

  <script type="module">
    // ✅ Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // ✅ Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAJ5I8k2MzAyDLt9fUcXHRNtRVjKB_ETLY",
      authDomain: "projectid-81104.firebaseapp.com",
      projectId: "projectid-81104",
      storageBucket: "projectid-81104.firebasestorage.app",
      messagingSenderId: "554913260457",
      appId: "1:554913260457:web:bf988867ebfd902c651ab8",
      measurementId: "G-8WFHQW5WGN"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const soalForm = document.getElementById('soalForm');
    const daftarSoal = document.getElementById('daftarSoal');
    const logoutBtn = document.getElementById('logoutBtn');

    // ✅ Cek user login
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        alert("Harus login dulu!");
        window.location.href = "login.html";
      }
    });

    // ✅ Logout
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "login.html";
    });

    // ✅ Tambahkan soal ke Firestore
    soalForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const soal = {
        pertanyaan: document.getElementById("pertanyaan").value,
        opsi: {
          A: document.getElementById("opsiA").value,
          B: document.getElementById("opsiB").value,
          C: document.getElementById("opsiC").value,
          D: document.getElementById("opsiD").value
        },
        jawaban: document.getElementById("jawaban").value,
        penjelasan: document.getElementById("penjelasan").value
      };

      await addDoc(collection(db, "soal"), soal);
      soalForm.reset();
      loadSoal();
    });

    // ✅ Ambil soal dari Firestore
    async function loadSoal() {
      daftarSoal.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "soal"));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const li = document.createElement("li");
        li.textContent = `${data.pertanyaan} (Jawaban: ${data.jawaban})`;
        daftarSoal.appendChild(li);
      });
    }

    loadSoal();
  </script>
</body>
</html>
